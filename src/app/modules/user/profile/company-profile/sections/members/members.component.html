<div class="members-container">
  <mat-toolbar class="toolbar">
    <div class="title-container">
      <span>Участники</span>
      <div class="badge">{{ participants.length }}</div>
    </div>
    <span class="spacer"></span>
    <button mat-flat-button class="btn-secondary" (click)="openAddMemberModal()">
      + Добавить участника
    </button>
  </mat-toolbar>

  <div class="content-container">
    <div class="table-wrapper">
      <div class="mat-table-wrapper">
        <table mat-table [dataSource]="participants" class="mat-elevation-z2 full-width">
          <ng-container matColumnDef="avatar">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let participant">
              <div class="avatar-container">
                <img *ngIf="getAvatar(participant.id!); else noAvatar"
                     [src]="getAvatar(participant.id!)"
                     alt="Avatar"
                     class="avatar">
                <ng-template #noAvatar>
                  <div class="w-full h-full flex items-center justify-center bg-gray-200 rounded-full">
                    <mat-icon svgIcon="ic-person" class="text-gray-500 text-2xl"></mat-icon>
                  </div>
                </ng-template>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-container">
                ФИО
                <mat-icon class="sort-icon">swap_vert</mat-icon>
              </div>
            </th>
            <td mat-cell *matCellDef="let participant">
              {{ participant.last_name || '' }} {{ participant.first_name || '' }}
            </td>
          </ng-container>

          <ng-container matColumnDef="contacts">
            <th mat-header-cell *matHeaderCellDef>Контакты</th>
            <td mat-cell *matCellDef="let participant">
              {{ participant.phone_number || 'Не указан' }} <br>
              <span class="email">{{ participant.email }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef>Роль</th>
            <td mat-cell *matCellDef="let participant">
              {{ participant.role }}
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let participant">
              <div class="actions-container" [ngClass]="{'visible': clickedRows.has(participant.id!)}">
                <button mat-icon-button (click)="openEditMemberModal(participant)">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button (click)="deleteParticipant(participant)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr
            mat-row
            *matRowDef="let participant; columns: displayedColumns;"
            (click)="toggleRow(participant)"
            [ngClass]="{'clicked': clickedRows.has(participant.id!)}"
          ></tr>
        </table>
      </div>
    </div>

    <mat-card class="license-card mat-elevation-z0">
      <mat-card-content class="license-container">
        <div class="license-info">
          <mat-icon class="info-icon">info</mat-icon>
          <span>Для продления лицензии обратитесь в отдел продаж</span>
        </div>
        <button mat-button class="btn-secondary">Написать</button>
      </mat-card-content>
    </mat-card>
  </div>
</div>
