<div class="flex flex-col w-full gap-3 mt-6" [class.mb-6]="teamPersonList.length">
  @for (teamPerson of teamPersonList; track $index) {
    <div class="flex flex-col justify-between px-6 py-4 gap-2 bg-[var(--background-alter)] rounded-2xl lg:flex-row">
      <div class="flex items-center gap-2">
        <div class="flex w-[80px] h-[80px] bg-[var(--background-main)] rounded-full">
          <mat-icon svgIcon="no-avatar" class="!w-[80px] !h-[80px] rounded-full" />
        </div>
        <div class="flex flex-col grow gap-1">
          <h4 class="text-[22px] leading-7">{{ teamPerson.full_name }}</h4>
          <div class="flex flex-col flex-wrap gap-y-1 gap-x-2 text-[var(--text-alter)] lg:flex-row lg:description-dots">
            <span>{{ teamPerson.roleName }}</span>
            <span>{{ teamPerson.email }}</span>
          </div>
        </div>
      </div>
      <div class="flex">
        @if (teamPerson.responsible) {
          <button mat-button class="btn-primary" disabled>
            <mat-icon class="text-[var(--text-alter)]">stars</mat-icon>
            <span class="text-[var(--text-alter)]">Ответственный</span>
          </button>
        } @else {
          <button mat-button class="btn-primary" (click)="setAsResponsible(teamPerson.id)">
            Сделать ответственным
          </button>
          <button mat-icon-button class="btn-danger" (click)="excludeUser(teamPerson.id)">
            <mat-icon svgIcon="delete" />
          </button>
        }
      </div>
    </div>
  }
</div>

<h2 class="text-[22px] leading-7 mb-2">Пригласить участников</h2>

<form class="flex flex-col w-full lg:w-1/2 mb-8">
  <span class="text-[14px] leading-5 text-[var(--text-alter)] tracking-[0.25px] mb-6">
    Вы можете пригласить зарегистрированного в системе пользователя
  </span>
  <mat-form-field class="mb-1" appearance="outline">
    <mat-label>Пользователь в системе</mat-label>
    <input
      matInput
      (change)="selectedUserId.reset()"
      (blur)="selectedUserId.markAsTouched()"
      [matAutocomplete]="inviteUserAutocomplete"
      [formControl]="searchUser" />
    <mat-autocomplete #inviteUserAutocomplete="matAutocomplete">
      @for (user of usersList; track $index) {
        <mat-option [value]="user.full_name" (onSelectionChange)="selectedUserId.setValue(user.id)">
          {{ user.full_name }}
        </mat-option>
      }
    </mat-autocomplete>
    @let inviteErrorRequired = selectedUserId.hasError('required') && !selectedUserId.untouched;
    @if (inviteErrorRequired) {
      <mat-icon matSuffix matTooltip="Выберите пользователя из списка" svgIcon="error" />
    }
  </mat-form-field>

  <div>
    <button mat-flat-button class="btn-primary" [disabled]="selectedUserId.invalid" (click)="inviteUser()">
      Пригласить
    </button>
  </div>
</form>
