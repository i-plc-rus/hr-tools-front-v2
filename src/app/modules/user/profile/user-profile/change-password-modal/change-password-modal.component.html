<div class="bg-[white] mt-10 md:mt-0 flex justify-center items-stretch flex-col min-w-full h-[460px] md:min-w-[748px] md:py-16 md:rounded-[28px]">
<div class="flex flex-col justify-center items-stretch py-16 px-2 lg:p-16">
  <p class="text-[2rem] leading-10 lg:text-[45px] lg:leading-[52px] text-center m-0 p-0">Сменить пароль</p>

    <div class="flex justify-start items-center flex-col grow-0 shrink-0 basis-auto mt-6">
      <form [formGroup]="changePasswordForm" class="flex items-center flex-col w-full box-border gap-4">
        <mat-form-field appearance="outline" class="w-full md:w-[400px]">
          <mat-label>Текущий пароль</mat-label>
          <input matInput type="password" formControlName="currentPassword" [type]="isOldPasswordVisible ? 'text' : 'password'">
          @if (currentPasswordError) {
            <p class="error-text">{{ currentPasswordError }}</p>
          }
          <button
            type="button"
            (click)="isOldPasswordVisible = !isOldPasswordVisible"
            class="absolute -mr-3 right-0 top-1 w-12 h-12 flex justify-center items-center cursor-pointer z-10 text-gray-500"
            tabindex="-1"
          >
            <mat-icon [svgIcon]="isOldPasswordVisible ? 'show-eye' : 'hide-eye'" class="password-toggle-icon"></mat-icon>
          </button>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full md:w-[400px]">
          <mat-label>Новый пароль</mat-label>
          <input matInput type="password" formControlName="newPassword" [type]="isNewPasswordVisible ? 'text' : 'password'">
          @let isNewPasswordRequired = changePasswordForm.controls['newPassword'].hasError('required') && !changePasswordForm.controls['newPassword'].untouched;
          @let isNewPasswordMinLength = changePasswordForm.controls['newPassword'].hasError('minlength') && !changePasswordForm.controls['newPassword'].untouched;
          <div matSuffix class="flex items-center">
            @if (isNewPasswordRequired || isNewPasswordMinLength) {
              <mat-icon matSuffix
                      [matTooltip]="isNewPasswordMinLength ? 'Пароль должен содержать не менее 8 символов' : 'Обязательное поле'"
                      svgIcon="error">
              </mat-icon>
            }
            <button
              type="button"
              (click)="isNewPasswordVisible = !isNewPasswordVisible"
              class="flex mr-2 justify-center items-center cursor-pointer text-gray-500 hover:bg-black/5 rounded-full w-10 h-10"
              tabindex="-1"
            >
              <mat-icon [svgIcon]="isNewPasswordVisible ? 'show-eye' : 'hide-eye'" class="password-toggle-icon"></mat-icon>
            </button>
          </div>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full md:w-[400px]">
          <mat-label>Подтвердите пароль</mat-label>
          <input matInput type="password" formControlName="confirmPassword" [type]="isNewCopyPasswordVisible ? 'text' : 'password'">
          @let isConfirmPasswordRequired = changePasswordForm.controls['confirmPassword'].hasError('required') && !changePasswordForm.controls['confirmPassword'].untouched;
          @let isPasswordMatch = changePasswordForm.controls['confirmPassword'].hasError('matching') && !changePasswordForm.controls['confirmPassword'].untouched;
          <div matSuffix class="flex items-center">
            @if (isConfirmPasswordRequired || isPasswordMatch) {
              <mat-icon matSuffix
                        [matTooltip]="isConfirmPasswordRequired ? 'Обязательное поле' : 'Пароли должны совпадать'"
                        svgIcon="error">
              </mat-icon>
            }
            <button
                type="button"
                (click)="isNewCopyPasswordVisible = !isNewCopyPasswordVisible"
                class="flex mr-2 justify-center items-center cursor-pointer text-gray-500 hover:bg-black/5 rounded-full w-10 h-10"
                tabindex="-1"
            >
              <mat-icon [svgIcon]="isNewCopyPasswordVisible ? 'show-eye' : 'hide-eye'" class="password-toggle-icon"></mat-icon>
            </button>
          </div>
        </mat-form-field>
      </form>

      <div class="flex flex-col grow-0 shrink-0 items-stretch justify-center basis-auto max-w-44 mt-6 gap-4 lg:flex-row-reverse lg:max-w-max">
        <button
          mat-flat-button
          class="btn-primary"
          (click)="savePassword()"
          [disabled]="changePasswordForm.invalid || isLoading">
          Сохранить
        </button>
        <button mat-flat-button class="btn-secondary" (click)="closeModal()">Отменить</button>
      </div>
    </div>
  </div>
</div>
